<!DOCTYPE HTML>
<!--
	Future Imperfect by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>Camera Calibration의 필요성에 관하여</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="../assets/css/main.css" />
		<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/latest.js?config=AM_CHTML"></script>
	</head>
	<body class="single is-preload">

		<!-- Wrapper -->
			<div id="wrapper">

				<!-- Header -->
					<header id="header">
						<h1><a href="../index.html">About "InSung"</a></h1>
						<nav class="links">
							<ul>
								<li><a href="../about.html">About</a></li>
								<li><a href="../lineup.html">Lineup</a></li>
								<li><a href="https://github.com/insung3511">Github</a></li>
								<li><address><a href="mailto:insung.park123@gmail.com">Email</a></address></li>
							</ul>
						</nav>
						<nav class="main">
							<ul>
								<li class="search">
									<a class="fa-search" href="#search">Search</a>
									<form id="search" method="get" action="#">
										<input type="text" name="query" placeholder="Search" />
									</form>
								</li>
							</ul>
						</nav>
					</header>
					
				<!-- Menu -->
					<section id="menu">

						<!-- Search -->
							<section>
								<form class="search" method="get" action="#">
									<input type="text" name="query" placeholder="Search" />
								</form>
							</section>
					</section>

				<!-- Main -->
					<div id="main">

						<!-- Post -->
							<article class="post">
								<header>
									<div class="title">
										<h2><a href="#">Camera Calibration의 필요성에 관하여</a></h2>
										<p>간단하면서 가장 기본적이고 필요한 내용 <strong>Camera Calibration</strong></p>
									</div>
									<div class="meta">
										<time class="published" datetime="2021-12-24">December 24, 2021</time>
										<a href="#" class="author"><span class="name">B. InSung</span><img src="../images/me.JPG" alt="" /></a>
									</div>
								</header>
								<span class="image featured"><img src="images/2021dec24/index.jpg" alt="" /></span>
								<p>12월 첫 포스팅이자 마지막 포스팅이 될 듯하다. 최근에 .NET을 공부하느라 컴퓨터 비전에 굉장히 소홀이 했다. 뭐 솔직하게 말해서 .NET 공부 보다는 노느라 바뻐서 그랬다고 해도 무방하다.</p>
								<p>Camera Calibration의 주 목적을 알게 되면 왜 필요한지 쉽게 이해가 된다. 가장 먼저 카메라로 인해 생기는 왜곡을 찾고 카메라에서 생기는 근본적인 오류, 왜곡이 되지 않은 사진에서의 각종 정보들을 읽어오냐가 중요하다. 일단 그 전에 카메라의 왜곡에 대해서 먼저 알고 넘어가야한다.</p>

								<p>주로 카메라의 왜곡현상은 크게 2개로 나눌수 있는데 가장 <strong>radial distortion</strong>가 있다. 직역하면 방사형 왜곡인데 주로 Fish-eye Lens와 같은 사진에서 생기는 왜곡이다. </p>
								<span class="image featured">
									<img src="images/2021dec24/img1.png" alt="" />
								</span>
								<p>왼쪽 No distortion을 제외한 가운데와 오른쪽 왜곡 이미지가 가장 잘 묘사했다고 생각이 된다. radial distortion은 위 사진에서 나오는 왜곡현상을 모두 의미한다. 가장 흔히 접하는 카메라 렌즈의 왜곡 현상이다. 물론 고의적으로 영상에 담겨지는 느낌이나 화각을 넓히기 위한 주 목적도 있겠지만 아무튼 왜곡은 왜곡이다.</p>
								

								<p>그리고 두번째 왜곡은 Tangential Distrotion이다. 이는 그리 흔치는 않지만 인스타그램이나 사진앱에서 각도 설정 등에서 볼 수 있는 기능 중에 하나이기도 하다. 명확히는 유사하다고 하는게 좋을 거 같다. 아까는 카메라의 렌즈에 대한 문제라고 하면 이번에는 카메라의 위치와 관점으로 생기는 문제라고 생각된다. 아래 사진을 보면 좀 이해가 쉬울 것이다.</p>
								<span class="image featured">
									<img src="images/2021dec24/img5.png">
								</span>
								<p>왼쪽을 카메라의 내부라고 생각하고 보면 되는데 우리 말로 좀 풀이를 하면 다음과 같다. 품질이 좋지 않은 카메라 렌즈와 CCD/CMOS (빛 데이터를 디지털화 해주는 회로) 가 제대로 고정이 되어 있지 않아 사진이 위에서 쳐다보듯 사다리꼴 형태로 생기는 카메라 왜곡 현상을 말한다. 물론 사다리꼴 형태 외에도 다양한 형태의 문제가 발생하기 일 수 이다만, 어떤 형식으로 문제가 생기는지는 카메라의 형태가 성능 등 여러 면에서 다르다고 볼 수 있다.</p>
								<p>아무튼 주 목적은 다양한 각도의 사진들에서 패턴을 분석하여 특정 이미지에 왜곡을 감소 시키는 것이다. 중요한 것은 어떤 객체를 중심으로 두고 어떤 패턴을 분석하냐가 큰 관건이다. OpenCV 에서는 함수명에서도 알 수 있듯이 ChessBoard (체스판 혹은 바둑판?) 을 중점으로 두고 하고 있다.</p>
								<span class="image featured">
									<img src="images/2021dec24/img2.png" alt="" />
								</span>
								<p>위와 같은 방식으로 패턴을 분석하게 된다. OpenCV 라이브러리 내에서는 총 14장의 각각 다양한 각도에서의 Chessboard 사진이 있다. 사실 Chessboard만 움직이는 사진이긴 하다만 다양한 각도이긴 하다. 무튼 14장의 사진을 분석을 한다.</p>
								<p>분석된 이미지 내에서 ChessBoard를 기준으로 위치 및 방향, 기울어짐 등 사진의 다양한 요소들을 찾아낸다. 그리고 최종적인 결과물을 보면 다음과 같이 왜곡현상이 확연히 줄어들었음을 볼 수가 있다.</p>
								<span class="image featured">
									<img src="images/2021dec24/img6.png" alt="" />
								</span>
								<p style="text-align: center; font-size: smaller;">왼쪽이 분석 후 왜곡현상을 줄인 사진, 오른쪽이 원본</p>
								<p>이렇게 분석을 통해 확연한 왜곡을 줄여주게 된다. 그렇다면 어떤 방식으로 되냐? Raidal이냐 Tangential 이냐에 따라 방식은 좀 달라진다. Radial은 다음과 같다.</p>
								<div style="text-align: center;">
									`x_"distorted"= x(1+k_1r^2+k_2r^4+k_3r^6)  ` <br />
									`y_"distorted"= y(1+k_1r^2+k_2r^4+k_3r^6)  `
								</div>

								<p>그리고 Tangential은 다음과 갍다.</p>
								<div style="text-align: center">
									`x_"distorted"=x+[2p_1xy+p_2(r^2+2x^2)]` <br />
									`y_"distorted"=y+[p_1(r^2+2x^2)+2p_2xy]` <br />
								</div> <br />
								<p>여기서 5개의 인자값이 가장 중요한 역할을 지니고 있다. `Distortion Coefficients = (k_1, k_2, p_1, p_2, k_3)` 가 왜곡 계수(?) 와 같다. 외곡 계수라 함은 카메라가 찾아야할 일종의 특징점이다. 이해가 안된다면 Camera Calibration의 목표를 다시 한번 생각하면 쉬울 것이다. 왜곡보정이 주 목표인 Camera Calibration은 여러 사진의 패턴을 분석하기 위해서는 각 사진에 특징점을 찾아 이를 분석하고 왜곡 보정을 진행해야 할 것이다. 여기서 특징 점을 분석을 하기 위한 일종의 그릇 같다. 그리고 그에 들어가는 재료나 음식들은 각 사진들의 차이점 혹은 패턴이 될 것이다.</p>
								<p>수학적인 부분에 대해서 좀 더 얘기를 해보자. 모든 이미지는 행렬로 이루워져 있다. 실제로 OpenCV 에서 cv2.imread 함수를 통해 읽어진 사진을 Text로 출력을 하면 행렬과 같은 방식으로 출력이 된다. 그렇기에 왜곡된 이미지 또한 행렬로 처리가 되는데 이때 일반적인 내부 파라미터의 영향이 제거된 렌즈 왜곡은 <strong>Normalized Image Plane</strong> 이라고 한다. 한국어로 직역을 해도 어느정도 감은 잡힐 것이다. 이를 다시 수학식으로 표현 하면 다음과 같다.</p>
								<div style="text-align: center;">
									`[x_"normalized undistorted", y_"normalized undistorted"] = [[X_"central projection" / Z_"central projection"], [Y_"central projection" / Z_"central projection"]]` 
								</div> <br />
								<p>여러번 다른 글에서 강조를 했지만 사진은 어디 까지나 2차원이다. 3차원인 물체를 찍으면 `x, y` 축이 있는 2차원이다. 그렇기에 렌즈 왜곡이 일어나진 이미지를 3차원으로 표현을 해주면 위와 같은 식을 만들 수 있다.</p>

								<p>그렇다면 왜곡이 일어난 이미지는 어떻게 수학적 모델로 표현이 되는가? 다음과 같다.</p>
								<div style="text-align: center; height: auto; width: auto;">
									`[x_"normalized distorted", y_"normalized distorted"] = (1 + k_1r_"undistorted"^2 + k_2*r_"undistorted"^4 + k_3r_"undistorted"^6) [x_"normalized undistorted", y_"normalized undistorted"] + [[2p_1*x_"normalized undistorted"*y_"normalized undistorted" + p_2(r^2_" undistorted" + 2x^2_"normalized undistorted")],[p_1(r^2_" undistorted" + 2y^2_"normalized undistorted") + 2p_2x_"normalized undistorted"y_"normalized undistorted"]]`
								</div>
							</article>
					</div>
					<div style="font: smaller; text-align: center; color: gray;">
						<li>
							<ol>참고 자료</ol>
								<ul>https://darkpgmr.tistory.com/31</ul>
						</li>
					</div>

				<!-- Footer -->
					<section id="footer">
						<p class="copyright">&copy; About "Insung". Design: <a href="http://html5up.net">HTML5 UP</a>.</p>
					</section>

			</div>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>

	</body>
</html>